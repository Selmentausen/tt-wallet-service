# Wallet Service (Тестовое задание)

REST API для работы с кошельком (пополнение, снятие, баланс).

## Запуск

Проект завернут в Docker. Для запуска нужна одна команда:

```bash
docker-compose up --build
```

Сервис запустится на порту **8080**.
База данных доступна снаружи на порту **5436** (логин/пароль в `config.env`).

## Тестирование

В проекте 2 вида тестов:

1. **Unit-тесты** (логика хендлеров и генерация SQL):
   ```bash
   go test ./... -v
   ```

2. **Интеграционные тесты** (проверка конкурентности на реальной БД).
   *Требует запущенного Docker.*
   Этот тест запускает 100 горутин и проверяет отсутствие гонок (Race Conditions).
   ```bash
   go test ./internal/repository/ -v -tags=integration
   ```

## О реализации

1. **Конкурентность (1000 RPS):**
   Реализована на уровне БД через атомарные запросы (`UPDATE ... WHERE balance >= amount` и `INSERT ... ON CONFLICT`). Это быстрее и надежнее, чем мьютексы в коде или `SELECT FOR UPDATE`.

2. **Пул соединений:**
   Настроил `SetMaxOpenConns` и `SetMaxIdleConns` (50), чтобы при пиковой нагрузке приложение не превышало лимиты Postgres (`too many clients`) и запросы ждали в очереди, а не падали с ошибкой.

3. **Тип данных:**
   В коде используется `float64` согласно примеру в задании. В реальном проекте для денег использовал бы `int64` (копейки) или `decimal`, чтобы избежать проблем с точностью float.